<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubik Motion Lab - Catalog</title>
    <style>
        :root {
            --bg-main: #F4F4F5;
            --bg-card: #FFFFFF;
            --text-main: #1D2430;
            --text-muted: #71717A;
            --border: #E4E4E7;
            --accent-new: #A1A1AA;
            --accent-progress: #F59E0B;
            --accent-learned: #10B981;
            --primary: #2563EB;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Avenir Next', system-ui, sans-serif; }
        body { background: var(--bg-main); color: var(--text-main); display: flex; flex-direction: column; height: 100vh; }

        /* Top Nav */
        header { background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 0 2rem; display: flex; gap: 2rem; align-items: center; height: 60px; flex-shrink: 0; }
        .nav-tab { padding: 0 1rem; height: 100%; display: flex; align-items: center; font-weight: bold; cursor: pointer; color: var(--text-muted); border-bottom: 2px solid transparent; }
        .nav-tab.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* Main Catalog */
        main { flex: 1; overflow-y: auto; padding: 2rem; }
        .subgroup-title { margin: 2rem 0 1rem 0; font-size: 1.2rem; color: var(--text-muted); border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }

        /* Card */
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; display: flex; flex-direction: column; gap: 0.75rem; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .preview-box { width: 80px; height: 80px; background: #E4E4E7; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #888; }
        .card-meta { text-align: right; }
        .case-name { font-weight: bold; font-size: 1.1rem; }
        .case-prob { font-size: 0.85rem; color: var(--text-muted); }
        .card-algo { font-family: monospace; font-size: 0.95rem; font-weight: 600; background: var(--bg-main); padding: 0.5rem; border-radius: 6px; word-break: break-all; }
        
        /* Status Indicators */
        .status-NEW { border-left: 4px solid var(--accent-new); }
        .status-IN_PROGRESS { border-left: 4px solid var(--accent-progress); }
        .status-LEARNED { border-left: 4px solid var(--accent-learned); }

        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 50; padding: 2rem; }
        .modal { background: var(--bg-card); border-radius: 16px; width: 100%; max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .modal-header { padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1.5rem; }
        
        .video-wrapper { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px; overflow: hidden; position: relative; }
        .video-wrapper video { width: 100%; height: 100%; object-fit: cover; }
        .queue-msg { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: white; background: rgba(0,0,0,0.8); font-weight: bold; }

        /* Modal Controls */
        .status-group { display: flex; gap: 0.5rem; }
        .btn { padding: 0.5rem 1rem; border: 1px solid var(--border); background: var(--bg-main); border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn[data-status="NEW"].active { background: var(--accent-new); color: white; border-color: var(--accent-new); }
        .btn[data-status="IN_PROGRESS"].active { background: var(--accent-progress); color: white; border-color: var(--accent-progress); }
        .btn[data-status="LEARNED"].active { background: var(--accent-learned); color: white; border-color: var(--accent-learned); }

        .algo-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .algo-option { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; }
        .algo-option:hover { background: var(--bg-main); }
        .algo-option input[type="radio"] { margin: 0; }
        .algo-option.custom-input { cursor: default; }
        .algo-option.custom-input input[type="text"] { flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; font-family: monospace; }
        
        .btn-render { background: var(--primary); color: white; border-color: var(--primary); width: 100%; padding: 0.75rem; margin-top: 1rem; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; line-height: 1; }
    </style>
</head>
<body>

    <header>
        <div class="nav-tab" data-category="F2L">F2L</div>
        <div class="nav-tab active" data-category="OLL">OLL</div>
        <div class="nav-tab" data-category="PLL">PLL</div>
    </header>

    <main id="catalog-container"></main>

    <div class="modal-backdrop" id="modal-backdrop">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <h2 id="m-name">Case Name</h2>
                    <div class="case-prob" id="m-prob">Probability</div>
                </div>
                <button class="close-btn" id="m-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="video-wrapper">
                    <video id="m-video" controls autoplay loop muted></video>
                    <div class="queue-msg" id="m-queue-msg">Video not rendered yet...</div>
                </div>

                <div>
                    <div class="case-prob" style="margin-bottom: 0.5rem;">Learning Status:</div>
                    <div class="status-group" id="m-status-group">
                        <button class="btn" data-status="NEW">Не трогал</button>
                        <button class="btn" data-status="IN_PROGRESS">В работе</button>
                        <button class="btn" data-status="LEARNED">Выучил</button>
                    </div>
                </div>

                <div>
                    <div class="case-prob" style="margin-bottom: 0.5rem;">Select Algorithm:</div>
                    <div class="algo-list" id="m-algo-list">
                        </div>
                </div>

                <button class="btn btn-render" id="m-render-btn">Request HD Render</button>
            </div>
        </div>
    </div>

    <script>
        // MOCK DATA: Structured around "Cases", not flat algorithms
        const state = {
            category: 'OLL',
            cases: [
                {
                    id: 'oll_21', category: 'OLL', subgroup: 'All Edges Oriented Correctly',
                    name: 'OCLL1-21', prob: '1/108', status: 'LEARNED',
                    activeAlgo: "(R U2 R') (U' R U R') (U' R U' R')",
                    alts: ["(R U2 R') (U' R U R') (U' R U' R')", "y (R U R' U) (R U' R' U) (R U2' R')"],
                    videoUrl: 'fake.mp4'
                },
                {
                    id: 'oll_33', category: 'OLL', subgroup: 'T-Shapes',
                    name: 'T1-33', prob: '1/54', status: 'IN_PROGRESS',
                    activeAlgo: "(R U R' U') (R' F R F')",
                    alts: ["(R U R' U') (R' F R F')"],
                    videoUrl: '' // simulates unrendered
                },
                {
                    id: 'oll_45', category: 'OLL', subgroup: 'T-Shapes',
                    name: 'T2-45', prob: '1/54', status: 'NEW',
                    activeAlgo: "F (R U R' U') F'",
                    alts: ["F (R U R' U') F'"],
                    videoUrl: 'fake.mp4'
                }
            ],
            activeCaseId: null
        };

        const DOM = {
            catalog: document.getElementById('catalog-container'),
            backdrop: document.getElementById('modal-backdrop'),
            mName: document.getElementById('m-name'),
            mProb: document.getElementById('m-prob'),
            mVideo: document.getElementById('m-video'),
            mQueueMsg: document.getElementById('m-queue-msg'),
            mStatusGroup: document.getElementById('m-status-group'),
            mAlgoList: document.getElementById('m-algo-list'),
            mClose: document.getElementById('m-close')
        };

        function init() {
            renderCatalog();
            
            // Tab switching
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    state.category = e.target.dataset.category;
                    renderCatalog();
                });
            });

            // Modal Close
            DOM.mClose.addEventListener('click', closeModal);
            DOM.backdrop.addEventListener('click', (e) => {
                if(e.target === DOM.backdrop) closeModal();
            });

            // Status switching in modal
            DOM.mStatusGroup.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const c = getActiveCase();
                    c.status = e.target.dataset.status;
                    updateModalState();
                    renderCatalog(); // update background cards
                });
            });
        }

        function renderCatalog() {
            DOM.catalog.innerHTML = '';
            const filtered = state.cases.filter(c => c.category === state.category);
            
            // Group by subgroup
            const grouped = filtered.reduce((acc, c) => {
                if (!acc[c.subgroup]) acc[c.subgroup] = [];
                acc[c.subgroup].push(c);
                return acc;
            }, {});

            for (const [subgroup, cases] of Object.entries(grouped)) {
                const title = document.createElement('h3');
                title.className = 'subgroup-title';
                title.textContent = subgroup;
                DOM.catalog.appendChild(title);

                const grid = document.createElement('div');
                grid.className = 'grid';

                cases.forEach(c => {
                    const card = document.createElement('div');
                    card.className = `card status-${c.status}`;
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="preview-box">SVG</div>
                            <div class="card-meta">
                                <div class="case-name">${c.name}</div>
                                <div class="case-prob">${c.prob}</div>
                            </div>
                        </div>
                        <div class="card-algo">${c.activeAlgo}</div>
                    `;
                    card.addEventListener('click', () => openModal(c.id));
                    grid.appendChild(card);
                });
                DOM.catalog.appendChild(grid);
            }
        }

        function getActiveCase() {
            return state.cases.find(c => c.id === state.activeCaseId);
        }

        function openModal(id) {
            state.activeCaseId = id;
            updateModalState();
            DOM.backdrop.style.display = 'flex';
        }

        function closeModal() {
            DOM.backdrop.style.display = 'none';
            DOM.mVideo.pause();
            DOM.mVideo.removeAttribute('src'); // Stop buffering
            state.activeCaseId = null;
        }

        function updateModalState() {
            const c = getActiveCase();
            DOM.mName.textContent = c.name;
            DOM.mProb.textContent = c.prob;

            // Media
            if (c.videoUrl) {
                DOM.mVideo.src = c.videoUrl;
                DOM.mVideo.style.display = 'block';
                DOM.mQueueMsg.style.display = 'none';
            } else {
                DOM.mVideo.style.display = 'none';
                DOM.mQueueMsg.style.display = 'flex';
            }

            // Status buttons
            DOM.mStatusGroup.querySelectorAll('.btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.status === c.status);
            });

            // Algo list
            DOM.mAlgoList.innerHTML = '';
            
            // Add known alternatives
            c.alts.forEach((algo, idx) => {
                const isSelected = c.activeAlgo === algo;
                const opt = document.createElement('label');
                opt.className = 'algo-option';
                opt.innerHTML = `
                    <input type="radio" name="algo_sel" value="${idx}" ${isSelected ? 'checked' : ''}>
                    <span style="font-family: monospace;">${algo}</span>
                `;
                opt.querySelector('input').addEventListener('change', () => {
                    c.activeAlgo = algo;
                    renderCatalog();
                });
                DOM.mAlgoList.appendChild(opt);
            });

            // Add Custom Input
            const isCustom = !c.alts.includes(c.activeAlgo);
            const customOpt = document.createElement('label');
            customOpt.className = 'algo-option custom-input';
            customOpt.innerHTML = `
                <input type="radio" name="algo_sel" value="custom" ${isCustom ? 'checked' : ''}>
                <input type="text" placeholder="Or enter custom algorithm..." value="${isCustom ? c.activeAlgo : ''}">
            `;
            
            const textInput = customOpt.querySelector('input[type="text"]');
            const radioInput = customOpt.querySelector('input[type="radio"]');

            textInput.addEventListener('input', (e) => {
                radioInput.checked = true;
                if(e.target.value.trim() !== "") {
                    c.activeAlgo = e.target.value;
                    renderCatalog();
                }
            });

            radioInput.addEventListener('change', () => {
                if(textInput.value.trim() !== "") {
                    c.activeAlgo = textInput.value;
                    renderCatalog();
                } else {
                    textInput.focus();
                }
            });

            DOM.mAlgoList.appendChild(customOpt);
        }

        init();
    </script>
</body>
</html>